<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Huina 2026: 奔赴山海</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
        :root {
            --accent-blue: #00d4ff;
            --accent-gold: #ffcc00;
        }

        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            overflow: hidden; background: #000;
            font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
        }

        /* 视差背景容器 */
        .scene {
            position: relative; width: 100%; height: 100%;
            background: #000;
            overflow: hidden;
        }

        /* 背景层 - 支持交叉淡入淡出和动态平移 */
        .bg-layer {
            position: absolute;
            top: 0; left: -5%; /* 稍微加宽，预留移动空间 */
            width: 110%; height: 100%;
            background-size: cover;
            background-position: center;
            opacity: 0;
            z-index: 10;
        }

        .bg-layer.active {
            opacity: 1;
            z-index: 11;
        }

        /* 背景遮罩，提升文字可读性 */
        .bg-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.4);
            z-index: 12; /* 遮罩在背景图之上 */
        }

        /* 远景：星空 (作为半透明叠加层) */
        .stars {
            position: absolute; top: 0; left: 0; width: 200%; height: 100%;
            background: url('../images/星空.jpg');
            animation: moveBg 60s linear infinite;
            z-index: 13; /* 放在遮罩之上，让星星闪烁在画面上 */
            pointer-events: none;
            opacity: 0.4;
            mix-blend-mode: screen; /* 关键：混合模式让黑色变透明，只保留星星 */
        }

        /* 中景：动态云层 */
        .clouds {
            position: absolute; bottom: 10%; left: 0; width: 200%; height: 50%;
            background: url('../images/云层.jpg') repeat-x;
            background-size: contain;
            opacity: 0.3;
            filter: blur(2px);
            animation: moveBg 30s linear infinite;
            z-index: 15; /* 放在背景图上面，增加氛围 */
            pointer-events: none;
        }

        /* 近景：飞驰的草地/流光 */
        .ground {
            position: absolute; bottom: 0; left: 0; width: 200%; height: 20%;
            background: linear-gradient(to bottom, transparent, rgba(255,255,255,0.1));
            border-top: 1px solid rgba(255,255,255,0.2);
            animation: moveBg 2s linear infinite;
            z-index: 20;
            pointer-events: none;
        }

        /* 马儿容器 */
        .horse-wrapper {
            position: absolute;
            left: 10%; 
            bottom: 10.5%; 
            z-index: 150; /* 确保在最顶层，不被任何内容遮挡 */
            transform: translateX(-50%);
            pointer-events: none;
        }

        .horse-img {
            width: 50px; /* 进一步缩小马儿，像进度条节点 */
            height: auto;
            filter: drop-shadow(0 0 10px rgba(255,255,255,0.8));
        }

        /* UI 内容层 */
        .ui-layer {
            position: absolute; top: 15%; width: 100%; text-align: center;
            z-index: 100; /* 内容层在马儿之下 */
            pointer-events: none;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .year-text {
            font-size: 100px; font-weight: 800; color: white;
            letter-spacing: 15px; margin: 0;
            text-shadow: 0 0 30px rgba(255,255,255,0.5);
            font-style: italic;
        }

        .year-title {
            font-size: 36px; color: var(--accent-gold);
            margin: 5px 0; letter-spacing: 10px;
            font-weight: 600;
            text-shadow: 0 0 15px rgba(255, 204, 0, 0.5);
        }

        .content-box {
            max-width: 800px;
            margin-top: 20px;
            opacity: 0;
            transform: translateY(20px);
            text-align: center;
        }

        .content-line {
            font-size: 24px;
            color: white;
            margin: 15px 0;
            letter-spacing: 3px;
            font-weight: 400;
            line-height: 1.8;
            text-shadow: 0 2px 10px rgba(0,0,0,0.8); /* 增加投影确保白字在复杂背景下清晰 */
        }

        .char {
            color: white;
            display: inline-block;
            opacity: 0;
        }

        /* 时间轴进度导航 */
        .timeline-nav {
            position: absolute;
            bottom: 8%;
            left: 10%;
            right: 10%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
        }

        /* 时间轴横线 */
        .timeline-nav::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background: rgba(255, 255, 255, 0.2);
            z-index: -1;
            transform: translateY(-50%);
        }

        /* 动态发光进度条 */
        .timeline-progress {
            position: absolute;
            top: 50%;
            left: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--accent-gold), #fff);
            box-shadow: 0 0 20px var(--accent-gold);
            z-index: -1;
            transform: translateY(-50%);
            width: 0; /* 由 JS 动态控制 */
        }

        .nav-dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid rgba(255, 255, 255, 0.5);
            position: relative;
        }

        .nav-dot::after {
            content: attr(data-year);
            position: absolute;
            top: 25px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255, 255, 255, 0.5);
            font-size: 12px;
            font-weight: bold;
        }

        .nav-dot.active {
            background: var(--accent-gold);
            transform: scale(1.2);
            box-shadow: 0 0 15px var(--accent-gold);
            border-color: white;
        }

        .nav-dot.active::after {
            color: var(--accent-gold);
        }

        /* 底部控制 */
        .controls {
            position: absolute; bottom: 8%; width: 100%;
            display: flex; justify-content: center; z-index: 30;
        }

        .btn-action {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white; padding: 18px 60px; font-size: 20px;
            cursor: pointer; backdrop-filter: blur(10px);
            transition: all 0.4s; letter-spacing: 5px;
            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%);
            opacity: 0; transform: translateY(20px); pointer-events: none; /* 初始隐藏 */
        }

        .btn-action:hover {
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0 0 30px white;
            transform: translateY(-5px);
        }

        /* 动画 */
        @keyframes moveBg {
            from { transform: translateX(0); }
            to { transform: translateX(-50%); }
        }

        /* 转场光幕 */
        #transition-flash {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: white; z-index: 100; display: none; opacity: 0;
        }

        /* 飞驰的线（增强速度感） */
        .speed-line {
            position: absolute; height: 1px; background: white; opacity: 0.3;
            width: 100px;
        }
    </style>
</head>
<body>

<div id="transition-flash"></div>

<div class="scene">
    <!-- 背景层 -->
    <div id="bg-1" class="bg-layer active"></div>
    <div id="bg-2" class="bg-layer"></div>
    <div class="bg-overlay"></div>

    <div class="stars"></div>
    <div class="clouds"></div>
    <div id="speed-lines"></div>
    <div class="ground"></div>

    <div class="ui-layer" id="ui-content">
        <h1 class="year-text" id="year-display">2021</h1>
        <h2 class="year-title" id="year-title">成立</h2>
        <div class="content-box" id="content-box">
            <!-- 内容将通过 JS 注入 -->
        </div>
    </div>

    <div class="horse-wrapper" id="horse-box">
        <img src="../images/golden%20horse%20running.webp"
             alt="Anime Horse" class="horse-img">
    </div>

    <div class="controls">
        <button class="btn-action" id="next-btn">跨越 2021 →</button>
    </div>

    <div class="timeline-nav" id="timeline-nav">
        <div class="timeline-progress" id="timeline-progress"></div>
    </div>
</div>

<script>
    const timelineData = [
        {
            year: "2021",
            title: "成立",
            content: ["汇纳肉业成立"],
            bg: "../images/2021-back.jpg",
            duration: 5
        },
        {
            year: "2022",
            title: "成长",
            content: [
                "2月 汇纳肉业广东总部成立",
                "7月 汇纳肉业沈阳分公司成立",
                "9月 汇纳肉业南宁分公司成立",
                "10月 汇纳肉业福建分公司成立"
            ],
            bg: "../images/2022-back.jpg",
            duration: 8
        },
        {
            year: "2023",
            title: "突围",
            content: [
                "4月 上海、沈阳、深圳、南宁成立营销中心",
                "7月 成立香港办事处",
                "9月 香港 7-11/百佳全线上架汇纳产品"
            ],
            bg: "../images/2023-back.jpg",
            duration: 10
        },
        {
            year: "2024",
            title: "亮剑",
            content: [
                "6月 新增南宁双汇工厂",
                "7月 新增四川泸州工厂和绵阳工厂",
                "8月 新增深圳平湖工厂"
            ],
            bg: "../images/2024-back.jpg",
            duration: 8
        },
        {
            year: "2025",
            title: "突破",
            content: ["数字化转型深度实践", "核心业务模块全面升级", "构建全链路数字化生态"],
            bg: "../images/2025-back.jpg",
            duration: 6
        },
        {
            year: "2026",
            title: "飞越",
            content: [""], // 清空此处文字，避免转场干扰
            bg: "../images/2026-back.jpg",
            duration: 5
        }
    ];

    class TimelineRunner {
        constructor() {
            this.currentIndex = 0;
            this.isAnimating = false;
            this.bgIndex = 1;
            this.autoPlayEnabled = false;
            
            this.uiContent = document.getElementById('ui-content');
            this.yearDisplay = document.getElementById('year-display');
            this.yearTitle = document.getElementById('year-title');
            this.contentBox = document.getElementById('content-box');
            this.nextBtn = document.getElementById('next-btn');
            this.navContainer = document.getElementById('timeline-nav');
            this.progressBar = document.getElementById('timeline-progress');
            this.horseBox = document.getElementById('horse-box');
            
            this.init();
        }

        init() {
            // 创建导航点
            timelineData.forEach((data, i) => {
                const dot = document.createElement('div');
                dot.className = `nav-dot ${i === 0 ? 'active' : ''}`;
                dot.setAttribute('data-year', data.year);
                dot.onclick = () => this.goToYear(i, true); 
                this.navContainer.appendChild(dot);
            });

            // 初始化第一个背景
            const firstBg = document.getElementById('bg-1');
            firstBg.style.backgroundImage = `url('${timelineData[0].bg}')`;
            firstBg.style.opacity = 1;
            
            // 初始化内容
            this.updateContent(0);
            
            // 初始化马儿位置
            this.horseBox.style.left = '10%';
            
            // 初始化进度条
            this.updateProgressBar(0);
            
            // 初始化按钮状态
            gsap.to(this.nextBtn, { opacity: 1, y: 0, pointerEvents: "auto", delay: 1 });
            
            // 绑定按钮
            this.nextBtn.onclick = () => {
                if (!this.autoPlayEnabled) {
                    this.autoPlayEnabled = true; 
                    this.nextStep();
                } else {
                    this.nextStep(true); 
                }
            };
            
            // 初始化速度线
            this.initSpeedLines();
            this.animateLines();
        }

        initSpeedLines() {
            const linesContainer = document.getElementById('speed-lines');
            for (let i = 0; i < 25; i++) {
                const line = document.createElement('div');
                line.className = 'speed-line';
                line.style.top = Math.random() * 100 + '%';
                line.style.left = Math.random() * 100 + '%';
                line.style.width = (Math.random() * 200 + 50) + 'px';
                linesContainer.appendChild(line);
            }
        }

        animateLines() {
            document.querySelectorAll('.speed-line').forEach(line => {
                let left = parseFloat(line.style.left);
                left -= this.isAnimating ? 20 : 2; 
                if (left < -20) left = 120;
                line.style.left = left + '%';
            });
            requestAnimationFrame(() => this.animateLines());
        }

        createStarTrail(x, y) {
            const star = document.createElement('div');
            const size = Math.random() * 8 + 2;
            star.style.cssText = `
                position: fixed; width: ${size}px; height: ${size}px; 
                background: var(--accent-gold); border-radius: 50%;
                left: ${x}px; top: ${y}px; z-index: 140;
                pointer-events: none; opacity: 0.8;
                box-shadow: 0 0 15px var(--accent-gold), 0 0 5px #fff;
            `;
            document.body.appendChild(star);
            
            gsap.to(star, {
                x: "-=" + (Math.random() * 150 + 50), // 向后急速飘散
                y: "+=" + (Math.random() * 80 - 40),
                opacity: 0,
                scale: 0,
                duration: 0.8 + Math.random() * 0.7,
                ease: "power2.out",
                onComplete: () => star.remove()
            });
        }

        updateProgressBar(index) {
            const percentage = (index / (timelineData.length - 1)) * 100;
            gsap.to(this.progressBar, { width: `${percentage}%`, duration: 0.5, ease: "power2.out" });
        }

        async goToYear(index, isAccelerated = false) {
            if (this.isAnimating || index === this.currentIndex) return;
            this.isAnimating = true;

            const moveDuration = isAccelerated ? 1 : (timelineData[index].duration || 5);
            const isSpecialJump = (this.currentIndex === 2 && index === 3); // 2023 (index 2) -> 2024 (index 3)

            // 1. 旧文字和按钮消失
            gsap.to(this.nextBtn, { opacity: 0, y: 20, pointerEvents: "none", duration: 0.3 });
            await gsap.to([this.yearDisplay, this.yearTitle, this.contentBox], {
                opacity: 0,
                y: -20,
                duration: 0.3,
                stagger: 0.05,
                ease: "power2.in"
            });

            // 2. 马儿横向移动 (加入跳跃和星光追影)
            const targetPos = 10 + (index * (80 / (timelineData.length - 1)));

            const horseTl = gsap.timeline({
                onUpdate: () => {
                    // 只有在非静止时产生追影
                    const rect = this.horseBox.getBoundingClientRect();
                    this.createStarTrail(rect.left + rect.width / 2, rect.top + rect.height / 2);
                    
                    // 动态更新线条进度 (根据马儿实际 left 坐标计算)
                    const currentLeft = parseFloat(gsap.getProperty(this.horseBox, "left"));
                    const totalTrackWidth = 80; // 10% to 90%
                    const progressPercent = ((currentLeft - 10) / totalTrackWidth) * 100;
                    gsap.set(this.progressBar, { width: `${progressPercent}%` });
                },
                onComplete: () => {
                    // 到达节点后点亮按钮
                    gsap.to(this.nextBtn, { 
                        opacity: 1, 
                        y: 0, 
                        pointerEvents: "auto", 
                        duration: 0.6,
                        ease: "back.out(1.7)"
                    });
                }
            });

            if (isSpecialJump) {
                // 【史诗级飞跃】跨过 2023 -> 2024
                horseTl.to(this.horseBox, {
                    left: `${targetPos}%`,
                    duration: moveDuration,
                    ease: "power1.inOut"
                }, 0);

                // 抛物线高度与姿态
                horseTl.to(this.horseBox, {
                    y: -200, // 跳得更高一点
                    rotation: 20, // 身体前倾
                    scale: 1.5, // 冲向镜头感
                    duration: moveDuration * 0.45,
                    ease: "power2.out"
                }, 0);

                horseTl.to(this.horseBox, {
                    y: 0,
                    rotation: 0,
                    scale: 1,
                    duration: moveDuration * 0.55,
                    ease: "bounce.out" // 落地有力的回弹
                }, moveDuration * 0.45);

                // 跳跃瞬间的爆发闪光
                gsap.fromTo(this.horseBox, 
                    { filter: "drop-shadow(0 0 0px #fff) brightness(1)" },
                    { filter: "drop-shadow(0 0 40px #fff) brightness(2)", duration: 0.4, yoyo: true, repeat: 1 }
                );
            } else {
                // 普通奔跑
                horseTl.to(this.horseBox, {
                    left: `${targetPos}%`,
                    duration: moveDuration,
                    ease: "none"
                });
            }
            
            // 3. 背景切换 + 平移 (保持同步)
            const nextBgId = `bg-${this.bgIndex === 1 ? 2 : 1}`;
            const currentBgId = `bg-${this.bgIndex}`;
            const nextBgEl = document.getElementById(nextBgId);
            const currentBgEl = document.getElementById(currentBgId);

            nextBgEl.style.backgroundImage = `url('${timelineData[index].bg}')`;
            gsap.set(nextBgEl, { x: isAccelerated ? 0 : "2%", opacity: 0 });
            
            gsap.to(currentBgEl, { opacity: 0, duration: 1 });
            gsap.to(nextBgEl, { 
                opacity: 1, 
                x: isAccelerated ? 0 : "-2%", 
                duration: moveDuration, 
                ease: "none" 
            });

            this.bgIndex = this.bgIndex === 1 ? 2 : 1;

            // 4. 更新 UI 状态
            this.currentIndex = index;
            document.querySelectorAll('.nav-dot').forEach((dot, i) => {
                dot.classList.toggle('active', i === index);
            });

            // 5. 准备新内容（拆分字符实现打字机）
            const data = timelineData[index];
            this.yearDisplay.innerText = data.year;
            this.yearTitle.innerText = data.title;
            this.contentBox.innerHTML = data.content.map(line => 
                `<div class="content-line">
                    ${line.split('').map(char => `<span class="char">${char === ' ' ? '&nbsp;' : char}</span>`).join('')}
                </div>`
            ).join('');

            this.nextBtn.innerText = index === timelineData.length - 1 ? "开启新篇章 →" : `跨越 ${data.year} →`;

            // 6. 文字出现动画 (打字机效果)
            // 标题显示
            gsap.fromTo([this.yearDisplay, this.yearTitle], 
                { opacity: 0, y: 20 },
                { opacity: 1, y: 0, duration: 0.4, stagger: 0.1 }
            );

            gsap.set(this.contentBox, { opacity: 1, y: 0 });
            const chars = this.contentBox.querySelectorAll('.char');
            
            // 计算同步打字速度
            const initialDelay = 0.5; 
            const availableTime = Math.max(0.1, moveDuration - initialDelay - 0.2);
            const charStagger = availableTime / chars.length;

            await gsap.to(chars, {
                opacity: 1,
                duration: 0.05, 
                stagger: charStagger,
                ease: "none",
                delay: initialDelay
            });

            this.isAnimating = false;

            // 7. 自动播放
            if (this.autoPlayEnabled && this.currentIndex < timelineData.length - 1) {
                setTimeout(() => {
                    if (!this.isAnimating) this.nextStep();
                }, 1500); 
            }
        }

        updateContent(index) {
            const data = timelineData[index];
            this.yearDisplay.innerText = data.year;
            this.yearTitle.innerText = data.title;
            this.contentBox.innerHTML = data.content.map(line => 
                `<div class="content-line">
                    ${line.split('').map(char => `<span class="char" style="opacity:1">${char === ' ' ? '&nbsp;' : char}</span>`).join('')}
                </div>`
            ).join('');
        }

        nextStep(isAccelerated = false) {
            if (this.currentIndex < timelineData.length - 1) {
                this.goToYear(this.currentIndex + 1, isAccelerated);
            } else {
                this.finalTransition();
            }
        }

        finalTransition() {
            this.isAnimating = true;
            localStorage.setItem('huina_interacted', 'true'); // 记录交互状态，供后续页面自动播放音频

            // 1. 清场特效：所有 UI 文字极速向上飘散消失，背景变暗
            gsap.to([this.uiContent, this.navContainer, this.nextBtn, ".controls"], {
                y: -200,
                opacity: 0,
                duration: 0.8,
                stagger: 0.1,
                ease: "power4.in"
            });

            // 2. 深度蓄力：马儿缓缓后退，缩小，周身金光剧烈闪烁
            gsap.to(this.horseBox, {
                scale: 0.6,
                x: "-=100",
                filter: "drop-shadow(0 0 50px #fff) brightness(3)",
                duration: 1.2,
                ease: "power2.inOut",
                onComplete: () => {
                    // 3. 破空冲击：马儿从屏幕中心爆发，使用“极客冰蓝”特效
                    gsap.to(this.horseBox, {
                        x: window.innerWidth / 2,
                        y: -window.innerHeight / 4,
                        scale: 45, // 更大的比例
                        opacity: 0,
                        duration: 2.0, // 增加到 2 秒，让看清过程
                        ease: "power4.in"
                    });

                    // 4. 冰蓝光幕：径向爆发
                    const flash = document.getElementById('transition-flash');
                    flash.style.display = 'block';
                    flash.style.background = "radial-gradient(circle at center, #fff 0%, #00f2ff 40%, #000 100%)";
                    
                    gsap.fromTo(flash, 
                        { opacity: 0, scale: 0.2 },
                        { 
                            opacity: 1, 
                            scale: 1,
                            duration: 1.5, 
                            delay: 1.0, // 马儿完全撞破屏幕时亮起
                            ease: "power2.out",
                            onComplete: () => {
                                window.location.href = 'oath.html'; // 跳转
                            }
                        }
                    );
                }
            });
        }
    }

    // 启动动画
    window.onload = () => {
        new TimelineRunner();
        
        // 背景音乐逻辑
        const bgm = new Audio('../audio/1-Cinematic Adventure Epic Trailer.mp3');
        bgm.loop = true;
        
        const startAudio = () => {
            bgm.play().catch(() => {
                // 浏览器限制，等待交互
                document.addEventListener('click', () => bgm.play(), { once: true });
            });
        };
        startAudio();
    };
</script>

</body>
</html>

